{"version":3,"sources":["../../../src/local/content/actions.js"],"names":["strings","requiredStrings","key","then","importedStrings","Object","entries","index","requiredString","catch","name","selectors","ACTIONLINK","SECTIONLINK","CMLINK","SECTIONNODE","TOGGLER","ADDSECTION","classes","LOCKED","state","addEventListener","element","_dispatchClick","_checkSectionlist","CourseEvents","sectionRefreshed","watch","handler","event","target","closest","methodName","_actionMethodName","dataset","action","requestName","charAt","toUpperCase","slice","_setAddSectionLocked","course","sectionlist","length","maxsections","sectionId","id","sectionInfo","reactive","get","preventDefault","exporter","getExporter","data","sectionid","sectiontitle","title","modalParams","movecoursesection","body","Templates","render","_showModal","modal","modalBody","_extractElement","getBody","currentElement","querySelector","_changeTagName","generalSection","tagName","for","dispatch","destroy","cmId","cmInfo","cmid","cmname","movecoursemodule","click","targetSectionId","targetCmId","dropData","cmDraggableData","nextcmid","section","cmlist","cmList","hassummary","rawtitle","confirm","saveButtonText","delete","type","ModalFactory","types","SAVE_CANCEL","getRoot","on","ModalEvents","save","e","locked","targets","getElements","forEach","classList","toggle","setElementLocked","Element","Error","newTagName","newElement","document","createElement","innerHTML","parentNode","replaceChild","Promise","resolve","reject","create","bodyRendered","setSaveButtonText","show","BaseComponent"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course state actions dispatcher.\n *\n * This module captures all data-dispatch links in the course content and dispatch the proper\n * state mutation, including any confirmation and modal required.\n *\n * @module     core_courseformat/local/content/actions\n * @class      core_courseformat/local/content/actions\n * @copyright  2021 Ferran Recio <ferran@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport {get_strings as getStrings, get_string as getString} from 'core/str';\nimport * as CourseEvents from 'core_course/events';\n\n// Load global strings.\nconst strings = {};\n\nconst requiredStrings = [\n    {key: 'movecoursesection'},\n    {key: 'movecoursemodule'},\n    {key: 'confirm'},\n    {key: 'delete'},\n];\n\ngetStrings(requiredStrings).then((importedStrings) => {\n    for (const [index, requiredString] of Object.entries(requiredStrings)) {\n        strings[requiredString.key] = importedStrings[index];\n    }\n    return;\n}).catch();\n\nexport default class extends BaseComponent {\n\n    /**\n     * Constructor hook.\n     */\n    create() {\n        // Optional component name for debugging.\n        this.name = 'content_actions';\n        // Default query selectors.\n        this.selectors = {\n            ACTIONLINK: `[data-action]`,\n            SECTIONLINK: `[data-for='section']`,\n            CMLINK: `[data-for='cm']`,\n            SECTIONNODE: `[data-for='sectionnode']`,\n            TOGGLER: `[data-toggle='collapse']`,\n            ADDSECTION: `[data-action='addSection']`,\n        };\n        // Default classes.\n        this.classes = {\n            LOCKED: 'dimmed',\n        };\n    }\n\n    /**\n     * Initial state ready method.\n     *\n     * @param {Object} state the state data.\n     *\n     */\n    stateReady(state) {\n        // Delegate dispatch clicks.\n        this.addEventListener(\n            this.element,\n            'click',\n            this._dispatchClick\n        );\n        // Check section limit.\n        this._checkSectionlist({state});\n        // Add an Event listener to recalculate limits it if a section HTML is altered.\n        this.addEventListener(\n            this.element,\n            CourseEvents.sectionRefreshed,\n            () => this._checkSectionlist({state})\n        );\n    }\n\n    /**\n     * Return the component watchers.\n     *\n     * @returns {Array} of watchers\n     */\n    getWatchers() {\n        return [\n            // Check section limit.\n            {watch: `course.sectionlist:updated`, handler: this._checkSectionlist},\n        ];\n    }\n\n    _dispatchClick(event) {\n\n        const target = event.target.closest(this.selectors.ACTIONLINK);\n        if (!target) {\n            return;\n        }\n\n        // Invoke proper method.\n        const methodName = this._actionMethodName(target.dataset.action);\n\n        if (this[methodName] !== undefined) {\n            this[methodName](target, event);\n        }\n    }\n\n    _actionMethodName(name) {\n        const requestName = name.charAt(0).toUpperCase() + name.slice(1);\n        return `_request${requestName}`;\n    }\n\n    /**\n     * Check the section list and disable some options if needed.\n     *\n     * @param {Object} detail the update details.\n     * @property {Object} state the state object.\n     */\n    _checkSectionlist({state}) {\n        // Disable \"add section\" actions if the course max sections has been exceeded.\n        this._setAddSectionLocked(state.course.sectionlist.length > state.course.maxsections);\n    }\n\n    /**\n     * Handle a move section request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestMoveSection(target, event) {\n        // Check we have an id.\n        const sectionId = target.dataset.id;\n\n        if (!sectionId) {\n            return;\n\n        }\n        const sectionInfo = this.reactive.get('section', sectionId);\n\n        event.preventDefault();\n\n        // Collect section information from the state.\n        const exporter = this.reactive.getExporter();\n        const data = exporter.course(this.reactive.state);\n\n        // Add the target section id and title.\n        data.sectionid = sectionInfo.id;\n        data.sectiontitle = sectionInfo.title;\n\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: strings.movecoursesection,\n            body: Templates.render('core_courseformat/local/content/movesection', data),\n        };\n\n        // Create the modal.\n        const modal = await this._showModal(modalParams);\n\n        const modalBody = this._extractElement(modal.getBody());\n\n        // Disable current element and section zero.\n        const currentElement = modalBody.querySelector(`${this.selectors.SECTIONLINK}[data-id='${sectionId}']`);\n        this._changeTagName(currentElement, 'span');\n        const generalSection = modalBody.querySelector(`${this.selectors.SECTIONLINK}[data-number='0']`);\n        this._changeTagName(generalSection, 'span');\n\n        // Capture click.\n        modalBody.addEventListener('click', (event) => {\n\n            const target = event.target;\n            if (target.tagName != 'A' || target.dataset.for != 'section' || target.dataset.id === undefined) {\n                return;\n            }\n\n            event.preventDefault();\n\n            this.reactive.dispatch('sectionMove', [sectionId], target.dataset.id);\n            modal.destroy();\n        });\n    }\n\n    /**\n     * Handle a move cm request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestMoveCm(target, event) {\n        // Check we have an id.\n        const cmId = target.dataset.id;\n\n        if (!cmId) {\n            return;\n        }\n\n        const cmInfo = this.reactive.get('cm', cmId);\n\n        event.preventDefault();\n\n        // Collect section information from the state.\n        const exporter = this.reactive.getExporter();\n        const data = exporter.course(this.reactive.state);\n\n        // Add the target cm info.\n        data.cmid = cmInfo.id;\n        data.cmname = cmInfo.name;\n\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: strings.movecoursemodule,\n            body: Templates.render('core_courseformat/local/content/movecm', data),\n        };\n\n        // Create the modal.\n        const modal = await this._showModal(modalParams);\n\n        const modalBody = this._extractElement(modal.getBody());\n\n        // Disable current element.\n        let currentElement = modalBody.querySelector(`${this.selectors.CMLINK}[data-id='${cmId}']`);\n        currentElement = this._changeTagName(currentElement, 'span');\n\n        // Open the cm section node if possible.\n        currentElement.closest(this.selectors.SECTIONNODE)?.querySelector(this.selectors.TOGGLER)?.click();\n\n        // Capture click.\n        modalBody.addEventListener('click', (event) => {\n\n            const target = event.target;\n            if (target.tagName != 'A' || target.dataset.for === undefined || target.dataset.id === undefined) {\n                return;\n            }\n            event.preventDefault();\n\n            // Get draggable data from cm or section to dispatch.\n            let targetSectionId;\n            let targetCmId;\n            if (target.dataset.for == 'cm') {\n                const dropData = exporter.cmDraggableData(this.reactive.state, target.dataset.id);\n                targetSectionId = dropData.sectionid;\n                targetCmId = dropData.nextcmid;\n            } else {\n                const section = this.reactive.get('section', target.dataset.id);\n                targetSectionId = target.dataset.id;\n                targetCmId = section?.cmlist[0];\n            }\n\n            this.reactive.dispatch('cmMove', [cmId], targetSectionId, targetCmId);\n            modal.destroy();\n        });\n    }\n\n    /**\n     * Handle a move cm request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestAddSection(target, event) {\n        event.preventDefault();\n        this.reactive.dispatch('addSection', target.dataset.id ?? 0);\n    }\n\n    /**\n     * Handle a move section request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestDeleteSection(target, event) {\n        // Check we have an id.\n        const sectionId = target.dataset.id;\n\n        if (!sectionId) {\n            return;\n        }\n        const sectionInfo = this.reactive.get('section', sectionId);\n\n        event.preventDefault();\n\n        const cmList = sectionInfo.cmlist ?? [];\n        if (cmList.length || sectionInfo.hassummary || sectionInfo.rawtitle) {\n            // We need confirmation if the section has something.\n            const modalParams = {\n                title: strings.confirm,\n                body: getString('confirmdeletesection', 'moodle', sectionInfo.title),\n                saveButtonText: strings.delete,\n                type: ModalFactory.types.SAVE_CANCEL,\n            };\n\n            const modal = await this._showModal(modalParams);\n\n            modal.getRoot().on(\n                ModalEvents.save,\n                e => {\n                    // Stop the default save button behaviour which is to close the modal.\n                    e.preventDefault();\n                    modal.destroy();\n                    this.reactive.dispatch('sectionDelete', [sectionId]);\n                }\n            );\n            return;\n        } else {\n            // We don't need confirmation to delete empty sections.\n            this.reactive.dispatch('sectionDelete', [sectionId]);\n        }\n    }\n\n    /**\n     * Disable all add sections actions.\n     *\n     * @param {boolean} locked the new locked value.\n     */\n    _setAddSectionLocked(locked) {\n        const targets = this.getElements(this.selectors.ADDSECTION);\n        targets.forEach(element => {\n            element.classList.toggle(this.classes.LOCKED, locked);\n            this.setElementLocked(element, locked);\n        });\n    }\n\n    /**\n     * Extract the DOM element from the param.\n     *\n     * Modals uses jQuery instead of vnailla JS. To prevent future problems, we use this method to\n     * normalize the element beforte using.\n     *\n     * @param {Node|Element} element DOM element or a jQuery object.\n     * @return {Element} the extracted element.\n     */\n    _extractElement(element) {\n        if (element instanceof Element) {\n            return element;\n        }\n        if (element.get !== undefined) {\n            return element.get(0);\n        }\n        throw Error(`Elements can only be extracted from js Element or jQuery nodes`);\n    }\n\n    /**\n     * Replace an element with a copy with a different tag name.\n     *\n     * @param {Element} element the original element\n     * @param {*} newTagName the new tag name\n     * @returns {Element} the new element or the original one if no change is made\n     */\n    _changeTagName(element, newTagName) {\n        if (element) {\n            const newElement = document.createElement(newTagName);\n            newElement.innerHTML = element.innerHTML;\n            element.parentNode.replaceChild(newElement, element);\n            return newElement;\n        }\n        return element;\n    }\n\n    /**\n     * Render a modal and return a body ready promise.\n     *\n     * @param {object} modalParams the modal params\n     * @return {Promise} the modal body ready promise\n     */\n    _showModal(modalParams) {\n        return new Promise((resolve, reject) => {\n            ModalFactory.create(modalParams).then((modal) => {\n                // Handle body loading event.\n                modal.getRoot().on(ModalEvents.bodyRendered, () => {\n                    resolve(modal);\n                });\n                // Configure some extra modal params.\n                if (modalParams.saveButtonText !== undefined) {\n                    modal.setSaveButtonText(modalParams.saveButtonText);\n                }\n                modal.show();\n                return;\n            }).catch(() => {\n                reject(`Cannot load modal content`);\n            });\n        });\n    }\n}\n"],"file":"actions.min.js"}