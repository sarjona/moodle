define ("tool_admin_presets/tree",["core/ajax","core/tree","core/templates","jquery"],function(a,b,c,d){var e=function(a,b,c,d){this.id=a;this.settingId=b;this.label=c;this.description=d;this.parent=null;this.displayed=!1;this.checked=!0;this.level=1;this.children=[]};e.prototype.hasChildren=function(){return 0<this.children.length};e.prototype.isEmpty=function(){return"category"===this.settingId&&!this.hasChildren()};var f=function(a){this.view=null;this.nodes=[];this.accessibleview=null;this.rootNode=document.getElementById(a)};f.prototype.init=function(a,c,d,f,g){var h=this,j=a.length;this.rootNode.innerHTML="";for(var k=[],l=0,m;l<j;l++){m=new e(c[l],a[l],decodeURIComponent(d[l]),decodeURIComponent(f[l]));this.nodes[m.id]=m}for(var o=0;o<j;o++){if("root"===g[o]){this.nodes[c[o]].parent=null}else{this.nodes[c[o]].parent=this.nodes[g[o]];this.nodes[g[o]].children.push(this.nodes[c[o]])}}for(var n in this.nodes){if(this.nodes.hasOwnProperty(n)){if(null===this.nodes[n].parent){k.push(this.display(n))}}}Promise.all(k).finally(function(){h.accessibleview=new b("#"+h.rootNode.getAttribute("id"))})};f.prototype.applyEvent=function(a){var b=this,c=this.nodes[a];if(c.displayed){var e=document.getElementById(a);e.addEventListener("focus",function(){if(c.hasChildren()){var e=[];c.children.forEach(function(a){e.push(b.display(a.id))});Promise.all(e).finally(function(){b.accessibleview.initialiseNodes(d("#"+a))})}});var f=document.getElementById(a+"_checkbox");f.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();b.setChecked(a,!c.checked)});e.addEventListener("keydown",function(d){if("Enter"===d.key){d.stopPropagation();d.preventDefault();b.setChecked(a,!c.checked)}})}};f.prototype.display=function(a){var b=this;return new Promise(function(d,e){var f=b.nodes[a];if(!f.displayed&&!f.isEmpty()){var g=null;if(null===f.parent){g=b.rootNode}else{g=document.getElementById(f.parent.id).getElementsByTagName("ul")[0];b.nodes[a].level=b.nodes[f.parent.id].level+1}var h="";if(f.hasChildren()){h="has-children"}var i="checkbox-unchecked";if(f.checked){i="checkbox-checked"}var j={id:f.id,level:f.level,label:f.label,has_children:h,checked:i};c.render("tool_admin_presets/tree_node",j).then(function(c){g.insertAdjacentHTML("beforeend",c);b.nodes[a].displayed=!0;b.applyEvent(a);d(!0)}).fail(function(a){e(!1);window.console.log(a)})}else{d(!0)}})};f.prototype.setChecked=function(a,b){var c=this,d=this.nodes[a];this.nodes[a].checked=b;if(d.displayed){var e=document.getElementById(a+"_checkbox");if(b){e.setAttribute("class","checkbox-checked")}else{e.setAttribute("class","checkbox-unchecked")}}if(d.hasChildren()){d.children.forEach(function(a){c.setChecked(a.id,b)})}};f.prototype.submit=function(a){var b=this,c=document.getElementById(a);c.addEventListener("click",function(){var c=document.getElementById(a).parentNode;c.getElementsByTagName("input").forEach(function(a){if("hidden"===a.getAttribute("type")){a.remove()}});for(var d in b.nodes){if(b.nodes.hasOwnProperty(d)){var e=b.nodes[d];if("category"!==e.settingId&&"page"!==e.settingId&&e.checked){var f=document.createElement("input");f.setAttribute("type","hidden");f.setAttribute("name",e.settingId);f.setAttribute("value","1");c.appendChild(f)}}}})};return{init:function init(b,c){a.call([{methodname:"tool_admin_presets_get_settings",args:{action:b,id:c}}],!0,!0)[0].done(function(a){var b=new f("settings_tree_div");b.init(a.ids,a.nodes,a.labels,a.descriptions,a.parents);b.submit("id_admin_presets_submit")})}}});
//# sourceMappingURL=tree.min.js.map
