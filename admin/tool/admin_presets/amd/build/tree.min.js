define(["core/yui","core/ajax"],(e,t)=>{let i=function(){this.view=null,this.nodes=null};return i.prototype.init=function(){return new Promise(t=>{e.use("yui2-treeview",e=>{this.view=new e.YUI2.widget.TreeView("settings_tree_div"),this.nodes=[],this.nodes.root=this.view.getRoot(),t(!0)})})},i.prototype.addNodes=function(t,i,n,s,o){return new Promise(d=>{e.use("yui2-treeview",e=>{let r=t.length;for(let l=0;l<r;l++){let r=t[l],g=i[l],h=decodeURIComponent(n[l]),p=decodeURIComponent(s[l]),a=o[l],u=new e.YUI2.widget.HTMLNode(h,this.nodes[a]);u.settingId=r,u.setNodesProperty("title",p),u.highlightState=1,this.nodes[g]=u,d(!0)}})})},i.prototype.render=function(){e.use("yui2-treeview",e=>{let t=this.view.getNodesByProperty("settingId","category");if(t)for(let e=0;e<t.length;e++)t[e].hasChildren()||this.view.popNode(t[e]);if(t=this.view.getRoot().children)for(let e=0;e<t.length;e++)t[e].hasChildren()||this.view.popNode(t[e]);this.view.setNodesProperty("propagateHighlightUp",!0),this.view.setNodesProperty("propagateHighlightDown",!0),this.view.subscribe("clickEvent",this.view.onEventToggleHighlight),this.view.render(),e.YUI2.util.Event.on("id_admin_presets_submit","click",()=>{let t=document.getElementById("id_admin_presets_submit").parentNode,i=this.view.getNodesByProperty("highlightState",1);if(e.YUI2.lang.isNull(i))e.YUI2.log("Nothing selected");else{let n=[];for(let e=0;e<i.length;e++){let s=i[e];if("category"!==s.settingId&&"page"!==s.settingId&&(n.push(s.settingId),!document.getElementById(s.settingId))){let e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name",s.settingId),e.setAttribute("value","1"),t.appendChild(e)}}e.YUI2.log("Checked settings:\n"+n.join("\n"),"info")}})})},{init:(e,n)=>{t.call([{methodname:"tool_admin_presets_get_settings",args:{action:e,id:n}}],!0,!0)[0].done(e=>{let t=new i;t.init().finally(()=>{t.addNodes(e.ids,e.nodes,e.labels,e.descriptions,e.parents).finally(()=>{t.render()})})})}}});
