<<<<<<< HEAD
define ("tool_admin_presets/tree",["core/yui","core/ajax"],function(a,b){var c=function(){this.view=null;this.nodes=null};c.prototype.init=function(){var b=this;return new Promise(function(c){a.use("yui2-treeview",function(a){b.view=new a.YUI2.widget.TreeView("settings_tree_div");b.nodes=[];b.nodes.root=b.view.getRoot();c(!0)})})};c.prototype.addNodes=function(b,c,d,e,f){var g=this;return new Promise(function(h){a.use("yui2-treeview",function(a){for(var j=b.length,k=0;k<j;k++){var l=b[k],m=c[k],n=decodeURIComponent(d[k]),o=decodeURIComponent(e[k]),p=f[k],q=new a.YUI2.widget.HTMLNode(n,g.nodes[p]);q.settingId=l;q.setNodesProperty("title",o);q.highlightState=1;g.nodes[m]=q;h(!0)}})})};c.prototype.render=function(){var b=this;a.use("yui2-treeview",function(a){var c=b.view.getNodesByProperty("settingId","category");if(c){for(var d=0;d<c.length;d++){if(!c[d].hasChildren()){b.view.popNode(c[d])}}}c=b.view.getRoot().children;if(c){for(var e=0;e<c.length;e++){if(!c[e].hasChildren()){b.view.popNode(c[e])}}}b.view.setNodesProperty("propagateHighlightUp",!0);b.view.setNodesProperty("propagateHighlightDown",!0);b.view.subscribe("clickEvent",b.view.onEventToggleHighlight);b.view.render();a.YUI2.util.Event.on("id_admin_presets_submit","click",function(){var c=document.getElementById("id_admin_presets_submit").parentNode,d=b.view.getNodesByProperty("highlightState",1);if(a.YUI2.lang.isNull(d)){a.YUI2.log("Nothing selected")}else{for(var e=[],f=0,g;f<d.length;f++){g=d[f];if("category"!==g.settingId&&"page"!==g.settingId){e.push(g.settingId);if(!document.getElementById(g.settingId)){var h=document.createElement("input");h.setAttribute("type","hidden");h.setAttribute("name",g.settingId);h.setAttribute("value","1");c.appendChild(h)}}}a.YUI2.log("Checked settings:\n"+e.join("\n"),"info")}})})};return{init:function init(a,d){b.call([{methodname:"tool_admin_presets_get_settings",args:{action:a,id:d}}],!0,!0)[0].done(function(a){var b=new c;b.init().finally(function(){b.addNodes(a.ids,a.nodes,a.labels,a.descriptions,a.parents).finally(function(){b.render()})})})}}});
//# sourceMappingURL=tree.min.js.map
=======
define(["core/ajax","core/tree","core/templates","jquery"],(e,t,i,n)=>{let s=function(e,t,i,n){this.id=e,this.settingId=t,this.label=i,this.description=n,this.parent=null,this.displayed=!1,this.checked=!0,this.level=1,this.children=[]};s.prototype.hasChildren=function(){return this.children.length>0},s.prototype.isEmpty=function(){return"category"===this.settingId&&!this.hasChildren()};let d=function(e){this.view=null,this.nodes=[],this.accessibleview=null,this.rootNode=document.getElementById(e)};return d.prototype.init=function(e,i,n,d,o){let l=e.length;this.rootNode.innerHTML="";let h=[];for(let t=0;t<l;t++){let o=new s(i[t],e[t],decodeURIComponent(n[t]),decodeURIComponent(d[t]));this.nodes[o.id]=o}for(let e=0;e<l;e++)"root"===o[e]?this.nodes[i[e]].parent=null:(this.nodes[i[e]].parent=this.nodes[o[e]],this.nodes[o[e]].children.push(this.nodes[i[e]]));for(var r in this.nodes)this.nodes.hasOwnProperty(r)&&null===this.nodes[r].parent&&h.push(this.display(r));Promise.all(h).finally(e=>{this.accessibleview=new t("#"+this.rootNode.getAttribute("id"))})},d.prototype.applyEvent=function(e){let t=this.nodes[e];if(t.displayed){let i=document.getElementById(e);i.addEventListener("focus",()=>{if(t.hasChildren()){let i=[];t.children.forEach(e=>{i.push(this.display(e.id))}),Promise.all(i).finally(t=>{this.accessibleview.initialiseNodes(n("#"+e))})}}),document.getElementById(e+"_checkbox").addEventListener("click",i=>{i.stopPropagation(),i.preventDefault(),this.setChecked(e,!t.checked)}),i.addEventListener("keydown",i=>{"Enter"===i.key&&(i.stopPropagation(),i.preventDefault(),this.setChecked(e,!t.checked))})}},d.prototype.display=function(e){return new Promise((t,n)=>{let s=this.nodes[e];if(s.displayed||s.isEmpty())t(!0);else{let d=null;null===s.parent?d=this.rootNode:(d=document.getElementById(s.parent.id).getElementsByTagName("ul")[0],this.nodes[e].level=this.nodes[s.parent.id].level+1);let o="";s.hasChildren()&&(o="has-children");let l="checkbox-unchecked";s.checked&&(l="checkbox-checked");let h={id:s.id,level:s.level,label:s.label,has_children:o,checked:l};i.render("tool_admin_presets/tree_node",h).then(i=>{d.insertAdjacentHTML("beforeend",i),this.nodes[e].displayed=!0,this.applyEvent(e),t(!0)}).fail(function(e){n(!1),console.error(e)})}})},d.prototype.setChecked=function(e,t){let i=this.nodes[e];if(this.nodes[e].checked=t,i.displayed){let i=document.getElementById(e+"_checkbox");t?i.setAttribute("class","checkbox-checked"):i.setAttribute("class","checkbox-unchecked")}i.hasChildren()&&i.children.forEach(e=>{this.setChecked(e.id,t)})},d.prototype.submit=function(e){document.getElementById(e).addEventListener("click",()=>{let t=document.getElementById(e).parentNode;for(var i in t.getElementsByTagName("input").forEach(e=>{"hidden"===e.getAttribute("type")&&e.remove()}),this.nodes)if(this.nodes.hasOwnProperty(i)){let e=this.nodes[i];if("category"!==e.settingId&&"page"!==e.settingId&&e.checked){let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",e.settingId),i.setAttribute("value","1"),t.appendChild(i)}}})},{init:(t,i)=>{e.call([{methodname:"tool_admin_presets_get_settings",args:{action:t,id:i}}],!0,!0)[0].done(e=>{let t=new d("settings_tree_div");t.init(e.ids,e.nodes,e.labels,e.descriptions,e.parents),t.submit("id_admin_presets_submit")})}}});
>>>>>>> 7304919a5a8 ([MDL-72112] - Make the tree accessible and remove YUI dependencies.)
